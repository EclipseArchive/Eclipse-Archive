\<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eclipse Archive: Guest</title>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: black;
            color: white;
            font-family: 'Source Code Pro', monospace;
            padding: 20px;
            margin: 0;
        }
        .terminal {
            position: absolute;
            top: 20px;
            left: 20px;
            white-space: pre-line;
        }
        .blink {
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        .disabled {
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="terminal" id="terminal"></div>
    <script>
        let activeInput = null;
        let currentUser = "Guest";
        
        async function fetchFile(filename) {
            try {
                const response = await fetch(`files/${filename}`);
                if (!response.ok) throw new Error("File not found");
                return await response.text();
            } catch (error) {
                return null;
            }
        }

        async function listDocuments() {
            const terminal = document.getElementById("terminal");
            terminal.innerHTML += "Listing Documents...\n----------------[Main]----------------\n";
            
            const filenames = ["Origin.txt", "Relations.txt"]; // Replace with dynamic fetching
            for (const filename of filenames) {
                const content = await fetchFile(filename);
                if (content) {
                    let firstLine = content.split("\n")[0];
                    if (firstLine.includes(currentUser)) {
                        terminal.innerHTML += `${filename}   [Open]\n`;
                    }
                }
            }
            terminal.innerHTML += "--------------------------------------\n";
        }

        async function openDocument(filename) {
            const terminal = document.getElementById("terminal");
            const content = await fetchFile(filename);
            
            if (!content) {
                terminal.innerHTML += `Error: File '${filename}' not found.\n`;
                return;
            }
            
            let lines = content.split("\n");
            if (!lines[0].includes(currentUser)) {
                terminal.innerHTML += `Access Denied: '${filename}'\n`;
                return;
            }
            
            terminal.innerHTML = `X:\\Archive\\Users\\${currentUser}> open ${filename}\nOpening...\n\n`;
            setTimeout(() => {
                terminal.innerHTML += lines.slice(1).join("\n") + "\n\nType 'back' to go back.\n";
                waitForBackCommand();
            }, 1500);
        }

        function waitForBackCommand() {
            let command = "";
            document.addEventListener("keydown", function handleBack(event) {
                if (event.key.length === 1) {
                    command += event.key;
                } else if (event.key === "Backspace") {
                    command = command.slice(0, -1);
                } else if (event.key === "Enter") {
                    if (command.trim() === "back") {
                        document.removeEventListener("keydown", handleBack);
                        terminal.innerHTML = "";
                        listDocuments();
                    }
                }
            });
        }

        function createCommandLine() {
            const terminal = document.getElementById("terminal");
            if (activeInput) {
                activeInput.classList.remove("blink");
                activeInput.parentElement.classList.add("disabled");
            }
            let inputLine = document.createElement("div");
            inputLine.innerHTML = `X:\\Archive\\Users\\${currentUser}> <span id="commandInput"></span><span class="blink">_</span>`;
            terminal.appendChild(inputLine);
            activeInput = inputLine.querySelector("#commandInput");
            listenForCommand();
        }

        function listenForCommand() {
            let command = "";
            document.addEventListener("keydown", function handleInput(event) {
                if (!activeInput) return;
                if (event.key.length === 1) {
                    command += event.key;
                } else if (event.key === "Backspace") {
                    command = command.slice(0, -1);
                } else if (event.key === "Enter") {
                    document.removeEventListener("keydown", handleInput);
                    processCommand(command.trim());
                    return;
                }
                activeInput.textContent = command;
            });
        }

        function processCommand(command) {
            const terminal = document.getElementById("terminal");
            terminal.innerHTML += "\n";
            
            if (command === "list") {
                listDocuments();
            } else if (command.startsWith("open ")) {
                openDocument(command.split(" ")[1]);
            } else if (command === "clear") {
                terminal.innerHTML = "";
            } else if (command === "logout") {
                terminal.innerHTML += "Logging out...\n";
                setTimeout(() => window.location.href = "index.html", 1500);
            } else if (command === "help") {
                terminal.innerHTML += "Available Commands:\n - list\n - open [filename]\n - clear\n - logout\n - help\n";
            } else {
                terminal.innerHTML += "Unknown command. Type 'help' for a list of commands.\n";
            }
            createCommandLine();
        }

        listDocuments();
    </script>
</body>
</html>
